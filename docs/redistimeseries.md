# TSBS Supplemental Guide: RedisTimeSeries

RedisTimeSeries is a Redis Module adding a Time Series data structure to Redis. This supplemental guide explains how
the data generated for TSBS is stored, additional flags available when
using the data importer (`tsbs_load_redistimeseries`). **This
should be read *after* the main README.**


---

## Installation

TSBS is a collection of Go programs (with some auxiliary bash and Python
scripts). The easiest way to get and install the Go programs is to use
`go get` and then `go install`:
```bash
# Fetch TSBS and its dependencies
$ go get github.com/timescale/tsbs
$ cd $GOPATH/src/github.com/timescale/tsbs/cmd
$ go get ./...

# Install redistimeseries binaries. 
cd $GOPATH/src/github.com/timescale/tsbs
make
```

## Full cycle TSBS RedisTimeSeries scripts

Instead of calling tsbs redistimeseries binaries directly, we also supply scripts/*.sh for convenience with many of the flags set to a reasonable default for RedisTimeSeries database. 

So for a Full cycle TSBS RedisTimeSeries benchmark, ensure that RedisTimeSeries is running and then use:

# functional full cycle 

```
scripts/functional/debug_responses_full_cycle_minitest_redistimeseries.sh
```


## Data format

Data generated by `tsbs_generate_data` for RedisTimeSeries is serialized in
`key timestamp value [key timestamp value ...]` format. Each metric reading is composed of `key timestamp value`. In addition to metric readings, 'tags' (including the location of the host, its operating system, etc) are added to each distinct time series at the moment of the first insertion, using [TS.ADD](https://oss.redislabs.com/redistimeseries/commands/#tsadd).

An example for the `cpu-only` use case, on the first metric reading for the `cpu_usage_user{3297394792}`, `cpu_usage_system{3297394792}`, and `cpu_usage_idle{3297394792}` metrics, they would be insert using [TS.ADD](https://oss.redislabs.com/redistimeseries/commands/#tsadd), in the following manner:
```text
TS.ADD cpu_usage_user{3297394792} 1451606400000 58 LABELS hostname host_0 region eu-central-1 datacenter eu-central-1a rack 6 os Ubuntu15.10 arch x86 team SF service 19 service_version 1 service_environment test measurement cpu fieldname usage_user
TS.ADD cpu_usage_system{3297394792} 1451606400000 2 LABELS hostname host_0 region eu-central-1 datacenter eu-central-1a rack 6 os Ubuntu15.10 arch x86 team SF service 19 service_version 1 service_environment test measurement cpu fieldname usage_system
TS.ADD cpu_usage_idle{3297394792} 1451606400000 24 LABELS hostname host_0 region eu-central-1 datacenter eu-central-1a rack 6 os Ubuntu15.10 arch x86 team SF service 19 service_version 1 service_environment test measurement cpu fieldname usage_idle
```

The second and following metric readings for the `cpu_usage_user{3297394792}`, `cpu_usage_system{3297394792}`, and `cpu_usage_idle{3297394792}` metrics would be inserted using [TS.MADD](https://oss.redislabs.com/redistimeseries/commands/#tsmadd) command:

```text
TS.MADD cpu_usage_user{3297394792} 1451606410000 57 cpu_usage_system{3297394792} 1451606410000 3 cpu_usage_idle{3297394792}
TS.MADD cpu_usage_user{3297394792} 1451606420000 58 cpu_usage_system{3297394792} 1451606420000 2 cpu_usage_idle{3297394792}
```

---

## `tsbs_load_redistimeseries` Additional Flags

### Database related

#### `-host` (type: `string`, default: `localhost:6379`)

The host:port for Redis connection.

#### `-connections` (type: `int`, default: `10`)

The number of connections per worker.

#### `-pipeline` (type: `int`, default: `50`)

The pipeline's size. Read the full documentation [here](https://redis.io/topics/pipelining).

### Miscellaneous

#### `-single-queue` (type: `boolean`, default: `true`)

Whether to use a single queue.

