#!/usr/bin/env sh
echo "--workers=1 --partitions=5 --chunk-time=5m --batch-size=2500"
cat /tmp/bulk_data/timescaledb-data.gz | gunzip | ../../bin/tsbs_load_timescaledb --do-create-db=true --host="localhost" --db-name="benchmark" --workers=1 --batch-size=2500 --field-index="VALUE-TIME" --time-partition-index=true --partitions=5 --chunk-time="5m" --field-index-count="-1"

<<-EOF
1622550061,267487.82,2.675000E+06,267487.82,26748.78,2.675000E+05,26748.78
1622550071,269879.04,5.375000E+06,268683.67,26987.90,5.375000E+05,26868.37
1622550081,272629.92,8.100000E+06,269998.45,27262.99,8.100000E+05,26999.85
1622550091,279874.22,1.090000E+07,272468.22,27987.42,1.090000E+06,27246.82
1622550101,270123.33,1.360000E+07,271999.45,27012.33,1.360000E+06,27199.95
1622550111,274986.09,1.635000E+07,272497.25,27498.61,1.635000E+06,27249.72
1622550121,262490.41,1.897500E+07,271067.66,26249.04,1.897500E+06,27106.77
1622550131,277439.90,2.175000E+07,271864.34,27743.99,2.175000E+06,27186.43
1622550141,282478.03,2.457500E+07,273043.67,28247.80,2.457500E+06,27304.37
1622550151,272602.73,2.730000E+07,272999.60,27260.27,2.730000E+06,27299.96
1622550161,269998.12,3.000000E+07,272726.73,26999.81,3.000000E+06,27272.67
1622550171,239934.68,3.240000E+07,269993.39,23993.47,3.240000E+06,26999.34
1622550181,279983.54,3.520000E+07,270761.88,27998.35,3.520000E+06,27076.19
1622550191,275093.14,3.795000E+07,271071.15,27509.31,3.795000E+06,27107.12
1622550201,267410.66,4.062500E+07,270827.05,26741.07,4.062500E+06,27082.70
1622550211,265088.85,4.327500E+07,270468.53,26508.88,4.327500E+06,27046.85
1622550221,277495.28,4.605000E+07,270881.87,27749.53,4.605000E+06,27088.19
1622550231,265004.40,4.870000E+07,270555.35,26500.44,4.870000E+06,27055.54

Summary:
loaded 50000000 metrics in 184.859sec with 1 workers (mean rate 270476.78 metrics/sec)
loaded 5000000 rows in 184.859sec with 1 workers (mean rate 27047.68 rows/sec)

select * from hypertable_detailed_size('cpu') ORDER BY node_name;
 table_bytes | index_bytes | toast_bytes | total_bytes | node_name
-------------+-------------+-------------+-------------+-----------
   677584896 |  2346614784 |     1720320 |  3025928192 |
EOF
